{"ast":null,"code":"'use strict';\n\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\nvar url = require('url'),\n  util = require('util'),\n  http = require('http'),\n  https = require('https'),\n  crypto = require('crypto'),\n  stream = require('stream'),\n  Ultron = require('ultron'),\n  Options = require('options'),\n  Sender = require('./Sender'),\n  Receiver = require('./Receiver'),\n  SenderHixie = require('./Sender.hixie'),\n  ReceiverHixie = require('./Receiver.hixie'),\n  Extensions = require('./Extensions'),\n  PerMessageDeflate = require('./PerMessageDeflate'),\n  EventEmitter = require('events').EventEmitter;\n\n/**\n * Constants\n */\n\n// Default protocol version\n\nvar protocolVersion = 13;\n\n// Close timeout\n\nvar closeTimeout = 30 * 1000; // Allow 30 seconds to terminate the connection cleanly\n\n/**\n * WebSocket implementation\n *\n * @constructor\n * @param {String} address Connection address.\n * @param {String|Array} protocols WebSocket protocols.\n * @param {Object} options Additional connection options.\n * @api public\n */\nfunction WebSocket(address, protocols, options) {\n  if (this instanceof WebSocket === false) {\n    return new WebSocket(address, protocols, options);\n  }\n  EventEmitter.call(this);\n  if (protocols && !Array.isArray(protocols) && 'object' === typeof protocols) {\n    // accept the \"options\" Object as the 2nd argument\n    options = protocols;\n    protocols = null;\n  }\n  if ('string' === typeof protocols) {\n    protocols = [protocols];\n  }\n  if (!Array.isArray(protocols)) {\n    protocols = [];\n  }\n  this._socket = null;\n  this._ultron = null;\n  this._closeReceived = false;\n  this.bytesReceived = 0;\n  this.readyState = null;\n  this.supports = {};\n  this.extensions = {};\n  this._binaryType = 'nodebuffer';\n  if (Array.isArray(address)) {\n    initAsServerClient.apply(this, address.concat(options));\n  } else {\n    initAsClient.apply(this, [address, protocols, options]);\n  }\n}\n\n/**\n * Inherits from EventEmitter.\n */\nutil.inherits(WebSocket, EventEmitter);\n\n/**\n * Ready States\n */\n[\"CONNECTING\", \"OPEN\", \"CLOSING\", \"CLOSED\"].forEach(function each(state, index) {\n  WebSocket.prototype[state] = WebSocket[state] = index;\n});\n\n/**\n * Gracefully closes the connection, after sending a description message to the server\n *\n * @param {Object} data to be sent to the server\n * @api public\n */\nWebSocket.prototype.close = function close(code, data) {\n  if (this.readyState === WebSocket.CLOSED) return;\n  if (this.readyState === WebSocket.CONNECTING) {\n    this.readyState = WebSocket.CLOSED;\n    return;\n  }\n  if (this.readyState === WebSocket.CLOSING) {\n    if (this._closeReceived && this._isServer) {\n      this.terminate();\n    }\n    return;\n  }\n  var self = this;\n  try {\n    this.readyState = WebSocket.CLOSING;\n    this._closeCode = code;\n    this._closeMessage = data;\n    var mask = !this._isServer;\n    this._sender.close(code, data, mask, function (err) {\n      if (err) self.emit('error', err);\n      if (self._closeReceived && self._isServer) {\n        self.terminate();\n      } else {\n        // ensure that the connection is cleaned up even when no response of closing handshake.\n        clearTimeout(self._closeTimer);\n        self._closeTimer = setTimeout(cleanupWebsocketResources.bind(self, true), closeTimeout);\n      }\n    });\n  } catch (e) {\n    this.emit('error', e);\n  }\n};\n\n/**\n * Pause the client stream\n *\n * @api public\n */\nWebSocket.prototype.pause = function pauser() {\n  if (this.readyState !== WebSocket.OPEN) throw new Error('not opened');\n  return this._socket.pause();\n};\n\n/**\n * Sends a ping\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\nWebSocket.prototype.ping = function ping(data, options, dontFailWhenClosed) {\n  if (this.readyState !== WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n  options = options || {};\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  this._sender.ping(data, options);\n};\n\n/**\n * Sends a pong\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\nWebSocket.prototype.pong = function (data, options, dontFailWhenClosed) {\n  if (this.readyState !== WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n  options = options || {};\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  this._sender.pong(data, options);\n};\n\n/**\n * Resume the client stream\n *\n * @api public\n */\nWebSocket.prototype.resume = function resume() {\n  if (this.readyState !== WebSocket.OPEN) throw new Error('not opened');\n  return this._socket.resume();\n};\n\n/**\n * Sends a piece of data\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean, compress: boolean\n * @param {function} Optional callback which is executed after the send completes\n * @api public\n */\n\nWebSocket.prototype.send = function send(data, options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n  if (this.readyState !== WebSocket.OPEN) {\n    if (typeof cb === 'function') cb(new Error('not opened'));else throw new Error('not opened');\n    return;\n  }\n  if (!data) data = '';\n  if (this._queue) {\n    var self = this;\n    this._queue.push(function () {\n      self.send(data, options, cb);\n    });\n    return;\n  }\n  options = options || {};\n  options.fin = true;\n  if (typeof options.binary === 'undefined') {\n    options.binary = data instanceof ArrayBuffer || data instanceof Buffer || data instanceof Uint8Array || data instanceof Uint16Array || data instanceof Uint32Array || data instanceof Int8Array || data instanceof Int16Array || data instanceof Int32Array || data instanceof Float32Array || data instanceof Float64Array;\n  }\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  if (typeof options.compress === 'undefined') options.compress = true;\n  if (!this.extensions[PerMessageDeflate.extensionName]) {\n    options.compress = false;\n  }\n  var readable = typeof stream.Readable === 'function' ? stream.Readable : stream.Stream;\n  if (data instanceof readable) {\n    startQueue(this);\n    var self = this;\n    sendStream(this, data, options, function send(error) {\n      process.nextTick(function tock() {\n        executeQueueSends(self);\n      });\n      if (typeof cb === 'function') cb(error);\n    });\n  } else {\n    this._sender.send(data, options, cb);\n  }\n};\n\n/**\n * Streams data through calls to a user supplied function\n *\n * @param {Object} Members - mask: boolean, binary: boolean, compress: boolean\n * @param {function} 'function (error, send)' which is executed on successive ticks of which send is 'function (data, final)'.\n * @api public\n */\nWebSocket.prototype.stream = function stream(options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n  var self = this;\n  if (typeof cb !== 'function') throw new Error('callback must be provided');\n  if (this.readyState !== WebSocket.OPEN) {\n    if (typeof cb === 'function') cb(new Error('not opened'));else throw new Error('not opened');\n    return;\n  }\n  if (this._queue) {\n    this._queue.push(function () {\n      self.stream(options, cb);\n    });\n    return;\n  }\n  options = options || {};\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  if (typeof options.compress === 'undefined') options.compress = true;\n  if (!this.extensions[PerMessageDeflate.extensionName]) {\n    options.compress = false;\n  }\n  startQueue(this);\n  function send(data, final) {\n    try {\n      if (self.readyState !== WebSocket.OPEN) throw new Error('not opened');\n      options.fin = final === true;\n      self._sender.send(data, options);\n      if (!final) process.nextTick(cb.bind(null, null, send));else executeQueueSends(self);\n    } catch (e) {\n      if (typeof cb === 'function') cb(e);else {\n        delete self._queue;\n        self.emit('error', e);\n      }\n    }\n  }\n  process.nextTick(cb.bind(null, null, send));\n};\n\n/**\n * Immediately shuts down the connection\n *\n * @api public\n */\nWebSocket.prototype.terminate = function terminate() {\n  if (this.readyState === WebSocket.CLOSED) return;\n  if (this._socket) {\n    this.readyState = WebSocket.CLOSING;\n\n    // End the connection\n    try {\n      this._socket.end();\n    } catch (e) {\n      // Socket error during end() call, so just destroy it right now\n      cleanupWebsocketResources.call(this, true);\n      return;\n    }\n\n    // Add a timeout to ensure that the connection is completely\n    // cleaned up within 30 seconds, even if the clean close procedure\n    // fails for whatever reason\n    // First cleanup any pre-existing timeout from an earlier \"terminate\" call,\n    // if one exists.  Otherwise terminate calls in quick succession will leak timeouts\n    // and hold the program open for `closeTimout` time.\n    if (this._closeTimer) {\n      clearTimeout(this._closeTimer);\n    }\n    this._closeTimer = setTimeout(cleanupWebsocketResources.bind(this, true), closeTimeout);\n  } else if (this.readyState === WebSocket.CONNECTING) {\n    cleanupWebsocketResources.call(this, true);\n  }\n};\n\n/**\n * Expose bufferedAmount\n *\n * @api public\n */\nObject.defineProperty(WebSocket.prototype, 'bufferedAmount', {\n  get: function get() {\n    var amount = 0;\n    if (this._socket) {\n      amount = this._socket.bufferSize || 0;\n    }\n    return amount;\n  }\n});\n\n/**\n * Expose binaryType\n *\n * This deviates from the W3C interface since ws doesn't support the required\n * default \"blob\" type (instead we define a custom \"nodebuffer\" type).\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nObject.defineProperty(WebSocket.prototype, 'binaryType', {\n  get: function get() {\n    return this._binaryType;\n  },\n  set: function set(type) {\n    if (type === 'arraybuffer' || type === 'nodebuffer') this._binaryType = type;else throw new SyntaxError('unsupported binaryType: must be either \"nodebuffer\" or \"arraybuffer\"');\n  }\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using function members.\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n['open', 'error', 'close', 'message'].forEach(function (method) {\n  Object.defineProperty(WebSocket.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? listener._listener ? listener._listener : listener : undefined;\n    },\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nWebSocket.prototype.addEventListener = function (method, listener) {\n  var target = this;\n  function onMessage(data, flags) {\n    if (flags.binary && this.binaryType === 'arraybuffer') data = new Uint8Array(data).buffer;\n    listener.call(target, new MessageEvent(data, !!flags.binary, target));\n  }\n  function onClose(code, message) {\n    listener.call(target, new CloseEvent(code, message, target));\n  }\n  function onError(event) {\n    event.type = 'error';\n    event.target = target;\n    listener.call(target, event);\n  }\n  function onOpen() {\n    listener.call(target, new OpenEvent(target));\n  }\n  if (typeof listener === 'function') {\n    if (method === 'message') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onMessage._listener = listener;\n      this.on(method, onMessage);\n    } else if (method === 'close') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onClose._listener = listener;\n      this.on(method, onClose);\n    } else if (method === 'error') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onError._listener = listener;\n      this.on(method, onError);\n    } else if (method === 'open') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onOpen._listener = listener;\n      this.on(method, onOpen);\n    } else {\n      this.on(method, listener);\n    }\n  }\n};\nmodule.exports = WebSocket;\nmodule.exports.buildHostHeader = buildHostHeader;\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction MessageEvent(dataArg, isBinary, target) {\n  this.type = 'message';\n  this.data = dataArg;\n  this.target = target;\n  this.binary = isBinary; // non-standard.\n}\n\n/**\n * W3C CloseEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction CloseEvent(code, reason, target) {\n  this.type = 'close';\n  this.wasClean = typeof code === 'undefined' || code === 1000;\n  this.code = code;\n  this.reason = reason;\n  this.target = target;\n}\n\n/**\n * W3C OpenEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction OpenEvent(target) {\n  this.type = 'open';\n  this.target = target;\n}\n\n// Append port number to Host header, only if specified in the url\n// and non-default\nfunction buildHostHeader(isSecure, hostname, port) {\n  var headerHost = hostname;\n  if (hostname) {\n    if (isSecure && port != 443 || !isSecure && port != 80) {\n      headerHost = headerHost + ':' + port;\n    }\n  }\n  return headerHost;\n}\n\n/**\n * Entirely private apis,\n * which may or may not be bound to a sepcific WebSocket instance.\n */\nfunction initAsServerClient(req, socket, upgradeHead, options) {\n  options = new Options({\n    protocolVersion: protocolVersion,\n    protocol: null,\n    extensions: {},\n    maxPayload: 0\n  }).merge(options);\n\n  // expose state properties\n  this.protocol = options.value.protocol;\n  this.protocolVersion = options.value.protocolVersion;\n  this.extensions = options.value.extensions;\n  this.supports.binary = this.protocolVersion !== 'hixie-76';\n  this.upgradeReq = req;\n  this.readyState = WebSocket.CONNECTING;\n  this._isServer = true;\n  this.maxPayload = options.value.maxPayload;\n  // establish connection\n  if (options.value.protocolVersion === 'hixie-76') {\n    establishConnection.call(this, ReceiverHixie, SenderHixie, socket, upgradeHead);\n  } else {\n    establishConnection.call(this, Receiver, Sender, socket, upgradeHead);\n  }\n}\nfunction initAsClient(address, protocols, options) {\n  options = new Options({\n    origin: null,\n    protocolVersion: protocolVersion,\n    host: null,\n    headers: null,\n    protocol: protocols.join(','),\n    agent: null,\n    // ssl-related options\n    pfx: null,\n    key: null,\n    passphrase: null,\n    cert: null,\n    ca: null,\n    ciphers: null,\n    rejectUnauthorized: null,\n    perMessageDeflate: true,\n    localAddress: null\n  }).merge(options);\n  if (options.value.protocolVersion !== 8 && options.value.protocolVersion !== 13) {\n    throw new Error('unsupported protocol version');\n  }\n\n  // verify URL and establish http class\n  var serverUrl = url.parse(address);\n  var isUnixSocket = serverUrl.protocol === 'ws+unix:';\n  if (!serverUrl.host && !isUnixSocket) throw new Error('invalid url');\n  var isSecure = serverUrl.protocol === 'wss:' || serverUrl.protocol === 'https:';\n  var httpObj = isSecure ? https : http;\n  var port = serverUrl.port || (isSecure ? 443 : 80);\n  var auth = serverUrl.auth;\n\n  // prepare extensions\n  var extensionsOffer = {};\n  var perMessageDeflate;\n  if (options.value.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(typeof options.value.perMessageDeflate !== true ? options.value.perMessageDeflate : {}, false);\n    extensionsOffer[PerMessageDeflate.extensionName] = perMessageDeflate.offer();\n  }\n\n  // expose state properties\n  this._isServer = false;\n  this.url = address;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = this.protocolVersion !== 'hixie-76';\n\n  // begin handshake\n  var key = new Buffer(options.value.protocolVersion + '-' + Date.now()).toString('base64');\n  var shasum = crypto.createHash('sha1');\n  shasum.update(key + '258EAFA5-E914-47DA-95CA-C5AB0DC85B11');\n  var expectedServerKey = shasum.digest('base64');\n  var agent = options.value.agent;\n  var headerHost = buildHostHeader(isSecure, serverUrl.hostname, port);\n  var requestOptions = {\n    port: port,\n    host: serverUrl.hostname,\n    headers: {\n      'Connection': 'Upgrade',\n      'Upgrade': 'websocket',\n      'Host': headerHost,\n      'Sec-WebSocket-Version': options.value.protocolVersion,\n      'Sec-WebSocket-Key': key\n    }\n  };\n\n  // If we have basic auth.\n  if (auth) {\n    requestOptions.headers.Authorization = 'Basic ' + new Buffer(auth).toString('base64');\n  }\n  if (options.value.protocol) {\n    requestOptions.headers['Sec-WebSocket-Protocol'] = options.value.protocol;\n  }\n  if (options.value.host) {\n    requestOptions.headers.Host = options.value.host;\n  }\n  if (options.value.headers) {\n    for (var header in options.value.headers) {\n      if (options.value.headers.hasOwnProperty(header)) {\n        requestOptions.headers[header] = options.value.headers[header];\n      }\n    }\n  }\n  if (Object.keys(extensionsOffer).length) {\n    requestOptions.headers['Sec-WebSocket-Extensions'] = Extensions.format(extensionsOffer);\n  }\n  if (options.isDefinedAndNonNull('pfx') || options.isDefinedAndNonNull('key') || options.isDefinedAndNonNull('passphrase') || options.isDefinedAndNonNull('cert') || options.isDefinedAndNonNull('ca') || options.isDefinedAndNonNull('ciphers') || options.isDefinedAndNonNull('rejectUnauthorized')) {\n    if (options.isDefinedAndNonNull('pfx')) requestOptions.pfx = options.value.pfx;\n    if (options.isDefinedAndNonNull('key')) requestOptions.key = options.value.key;\n    if (options.isDefinedAndNonNull('passphrase')) requestOptions.passphrase = options.value.passphrase;\n    if (options.isDefinedAndNonNull('cert')) requestOptions.cert = options.value.cert;\n    if (options.isDefinedAndNonNull('ca')) requestOptions.ca = options.value.ca;\n    if (options.isDefinedAndNonNull('ciphers')) requestOptions.ciphers = options.value.ciphers;\n    if (options.isDefinedAndNonNull('rejectUnauthorized')) requestOptions.rejectUnauthorized = options.value.rejectUnauthorized;\n    if (!agent) {\n      // global agent ignores client side certificates\n      agent = new httpObj.Agent(requestOptions);\n    }\n  }\n  requestOptions.path = serverUrl.path || '/';\n  if (agent) {\n    requestOptions.agent = agent;\n  }\n  if (isUnixSocket) {\n    requestOptions.socketPath = serverUrl.pathname;\n  }\n  if (options.value.localAddress) {\n    requestOptions.localAddress = options.value.localAddress;\n  }\n  if (options.value.origin) {\n    if (options.value.protocolVersion < 13) requestOptions.headers['Sec-WebSocket-Origin'] = options.value.origin;else requestOptions.headers.Origin = options.value.origin;\n  }\n  var self = this;\n  var req = httpObj.request(requestOptions);\n  req.on('error', function onerror(error) {\n    self.emit('error', error);\n    cleanupWebsocketResources.call(self, error);\n  });\n  req.once('response', function response(res) {\n    var error;\n    if (!self.emit('unexpected-response', req, res)) {\n      error = new Error('unexpected server response (' + res.statusCode + ')');\n      req.abort();\n      self.emit('error', error);\n    }\n    cleanupWebsocketResources.call(self, error);\n  });\n  req.once('upgrade', function upgrade(res, socket, upgradeHead) {\n    if (self.readyState === WebSocket.CLOSED) {\n      // client closed before server accepted connection\n      self.emit('close');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n    var serverKey = res.headers['sec-websocket-accept'];\n    if (typeof serverKey === 'undefined' || serverKey !== expectedServerKey) {\n      self.emit('error', 'invalid server key');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n    var serverProt = res.headers['sec-websocket-protocol'];\n    var protList = (options.value.protocol || \"\").split(/, */);\n    var protError = null;\n    if (!options.value.protocol && serverProt) {\n      protError = 'server sent a subprotocol even though none requested';\n    } else if (options.value.protocol && !serverProt) {\n      protError = 'server sent no subprotocol even though requested';\n    } else if (serverProt && protList.indexOf(serverProt) === -1) {\n      protError = 'server responded with an invalid protocol';\n    }\n    if (protError) {\n      self.emit('error', protError);\n      self.removeAllListeners();\n      socket.end();\n      return;\n    } else if (serverProt) {\n      self.protocol = serverProt;\n    }\n    var serverExtensions = Extensions.parse(res.headers['sec-websocket-extensions']);\n    if (perMessageDeflate && serverExtensions[PerMessageDeflate.extensionName]) {\n      try {\n        perMessageDeflate.accept(serverExtensions[PerMessageDeflate.extensionName]);\n      } catch (err) {\n        self.emit('error', 'invalid extension parameter');\n        self.removeAllListeners();\n        socket.end();\n        return;\n      }\n      self.extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n    }\n    establishConnection.call(self, Receiver, Sender, socket, upgradeHead);\n\n    // perform cleanup on http resources\n    req.removeAllListeners();\n    req = null;\n    agent = null;\n  });\n  req.end();\n  this.readyState = WebSocket.CONNECTING;\n}\nfunction establishConnection(ReceiverClass, SenderClass, socket, upgradeHead) {\n  var ultron = this._ultron = new Ultron(socket),\n    called = false,\n    self = this;\n  socket.setTimeout(0);\n  socket.setNoDelay(true);\n  this._receiver = new ReceiverClass(this.extensions, this.maxPayload);\n  this._socket = socket;\n\n  // socket cleanup handlers\n  ultron.on('end', cleanupWebsocketResources.bind(this));\n  ultron.on('close', cleanupWebsocketResources.bind(this));\n  ultron.on('error', cleanupWebsocketResources.bind(this));\n\n  // ensure that the upgradeHead is added to the receiver\n  function firstHandler(data) {\n    if (called || self.readyState === WebSocket.CLOSED) return;\n    called = true;\n    socket.removeListener('data', firstHandler);\n    ultron.on('data', realHandler);\n    if (upgradeHead && upgradeHead.length > 0) {\n      realHandler(upgradeHead);\n      upgradeHead = null;\n    }\n    if (data) realHandler(data);\n  }\n\n  // subsequent packets are pushed straight to the receiver\n  function realHandler(data) {\n    self.bytesReceived += data.length;\n    self._receiver.add(data);\n  }\n  ultron.on('data', firstHandler);\n\n  // if data was passed along with the http upgrade,\n  // this will schedule a push of that on to the receiver.\n  // this has to be done on next tick, since the caller\n  // hasn't had a chance to set event handlers on this client\n  // object yet.\n  process.nextTick(firstHandler);\n\n  // receiver event handlers\n  self._receiver.ontext = function ontext(data, flags) {\n    flags = flags || {};\n    self.emit('message', data, flags);\n  };\n  self._receiver.onbinary = function onbinary(data, flags) {\n    flags = flags || {};\n    flags.binary = true;\n    self.emit('message', data, flags);\n  };\n  self._receiver.onping = function onping(data, flags) {\n    flags = flags || {};\n    self.pong(data, {\n      mask: !self._isServer,\n      binary: flags.binary === true\n    }, true);\n    self.emit('ping', data, flags);\n  };\n  self._receiver.onpong = function onpong(data, flags) {\n    self.emit('pong', data, flags || {});\n  };\n  self._receiver.onclose = function onclose(code, data, flags) {\n    flags = flags || {};\n    self._closeReceived = true;\n    self.close(code, data);\n  };\n  self._receiver.onerror = function onerror(reason, errorCode) {\n    // close the connection when the receiver reports a HyBi error code\n    self.close(typeof errorCode !== 'undefined' ? errorCode : 1002, '');\n    self.emit('error', reason instanceof Error ? reason : new Error(reason));\n  };\n\n  // finalize the client\n  this._sender = new SenderClass(socket, this.extensions);\n  this._sender.on('error', function onerror(error) {\n    self.close(1002, '');\n    self.emit('error', error);\n  });\n  this.readyState = WebSocket.OPEN;\n  this.emit('open');\n}\nfunction startQueue(instance) {\n  instance._queue = instance._queue || [];\n}\nfunction executeQueueSends(instance) {\n  var queue = instance._queue;\n  if (typeof queue === 'undefined') return;\n  delete instance._queue;\n  for (var i = 0, l = queue.length; i < l; ++i) {\n    queue[i]();\n  }\n}\nfunction sendStream(instance, stream, options, cb) {\n  stream.on('data', function incoming(data) {\n    if (instance.readyState !== WebSocket.OPEN) {\n      if (typeof cb === 'function') cb(new Error('not opened'));else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n    options.fin = false;\n    instance._sender.send(data, options);\n  });\n  stream.on('end', function end() {\n    if (instance.readyState !== WebSocket.OPEN) {\n      if (typeof cb === 'function') cb(new Error('not opened'));else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n    options.fin = true;\n    instance._sender.send(null, options);\n    if (typeof cb === 'function') cb(null);\n  });\n}\nfunction cleanupWebsocketResources(error) {\n  if (this.readyState === WebSocket.CLOSED) return;\n  this.readyState = WebSocket.CLOSED;\n  clearTimeout(this._closeTimer);\n  this._closeTimer = null;\n\n  // If the connection was closed abnormally (with an error), or if\n  // the close control frame was not received then the close code\n  // must default to 1006.\n  if (error || !this._closeReceived) {\n    this._closeCode = 1006;\n  }\n  this.emit('close', this._closeCode || 1000, this._closeMessage || '');\n  if (this._socket) {\n    if (this._ultron) this._ultron.destroy();\n    this._socket.on('error', function onerror() {\n      try {\n        this.destroy();\n      } catch (e) {}\n    });\n    try {\n      if (!error) this._socket.end();else this._socket.destroy();\n    } catch (e) {/* Ignore termination errors */}\n    this._socket = null;\n    this._ultron = null;\n  }\n  if (this._sender) {\n    this._sender.removeAllListeners();\n    this._sender = null;\n  }\n  if (this._receiver) {\n    this._receiver.cleanup();\n    this._receiver = null;\n  }\n  if (this.extensions[PerMessageDeflate.extensionName]) {\n    this.extensions[PerMessageDeflate.extensionName].cleanup();\n  }\n  this.extensions = null;\n  this.removeAllListeners();\n  this.on('error', function onerror() {}); // catch all errors after this\n  delete this._queue;\n}","map":{"version":3,"names":["url","require","util","http","https","crypto","stream","Ultron","Options","Sender","Receiver","SenderHixie","ReceiverHixie","Extensions","PerMessageDeflate","EventEmitter","protocolVersion","closeTimeout","WebSocket","address","protocols","options","call","Array","isArray","_socket","_ultron","_closeReceived","bytesReceived","readyState","supports","extensions","_binaryType","initAsServerClient","apply","concat","initAsClient","inherits","forEach","each","state","index","prototype","close","code","data","CLOSED","CONNECTING","CLOSING","_isServer","terminate","self","_closeCode","_closeMessage","mask","_sender","err","emit","clearTimeout","_closeTimer","setTimeout","cleanupWebsocketResources","bind","e","pause","pauser","OPEN","Error","ping","dontFailWhenClosed","pong","resume","send","cb","_queue","push","fin","binary","ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","Float32Array","Float64Array","compress","extensionName","readable","Readable","Stream","startQueue","sendStream","error","process","nextTick","tock","executeQueueSends","final","end","Object","defineProperty","get","amount","bufferSize","set","type","SyntaxError","method","listener","listeners","_listener","undefined","removeAllListeners","addEventListener","target","onMessage","flags","binaryType","buffer","MessageEvent","onClose","message","CloseEvent","onError","event","onOpen","OpenEvent","on","module","exports","buildHostHeader","dataArg","isBinary","reason","wasClean","isSecure","hostname","port","headerHost","req","socket","upgradeHead","protocol","maxPayload","merge","value","upgradeReq","establishConnection","origin","host","headers","join","agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","perMessageDeflate","localAddress","serverUrl","parse","isUnixSocket","httpObj","auth","extensionsOffer","offer","Date","now","toString","shasum","createHash","update","expectedServerKey","digest","requestOptions","Authorization","Host","header","hasOwnProperty","keys","length","format","isDefinedAndNonNull","Agent","path","socketPath","pathname","Origin","request","onerror","once","response","res","statusCode","abort","upgrade","serverKey","serverProt","protList","split","protError","indexOf","serverExtensions","accept","ReceiverClass","SenderClass","ultron","called","setNoDelay","_receiver","firstHandler","removeListener","realHandler","add","ontext","onbinary","onping","onpong","onclose","errorCode","instance","queue","i","l","incoming","destroy","cleanup"],"sources":["C:/Users/walle/Documents/lummelundalogin/lummelundalogin/node_modules/engine.io/node_modules/ws/lib/WebSocket.js"],"sourcesContent":["'use strict';\n\n/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar url = require('url')\n  , util = require('util')\n  , http = require('http')\n  , https = require('https')\n  , crypto = require('crypto')\n  , stream = require('stream')\n  , Ultron = require('ultron')\n  , Options = require('options')\n  , Sender = require('./Sender')\n  , Receiver = require('./Receiver')\n  , SenderHixie = require('./Sender.hixie')\n  , ReceiverHixie = require('./Receiver.hixie')\n  , Extensions = require('./Extensions')\n  , PerMessageDeflate = require('./PerMessageDeflate')\n  , EventEmitter = require('events').EventEmitter;\n\n/**\n * Constants\n */\n\n// Default protocol version\n\nvar protocolVersion = 13;\n\n// Close timeout\n\nvar closeTimeout = 30 * 1000; // Allow 30 seconds to terminate the connection cleanly\n\n/**\n * WebSocket implementation\n *\n * @constructor\n * @param {String} address Connection address.\n * @param {String|Array} protocols WebSocket protocols.\n * @param {Object} options Additional connection options.\n * @api public\n */\nfunction WebSocket(address, protocols, options) {\n  if (this instanceof WebSocket === false) {\n    return new WebSocket(address, protocols, options);\n  }\n\n  EventEmitter.call(this);\n\n  if (protocols && !Array.isArray(protocols) && 'object' === typeof protocols) {\n    // accept the \"options\" Object as the 2nd argument\n    options = protocols;\n    protocols = null;\n  }\n\n  if ('string' === typeof protocols) {\n    protocols = [ protocols ];\n  }\n\n  if (!Array.isArray(protocols)) {\n    protocols = [];\n  }\n\n  this._socket = null;\n  this._ultron = null;\n  this._closeReceived = false;\n  this.bytesReceived = 0;\n  this.readyState = null;\n  this.supports = {};\n  this.extensions = {};\n  this._binaryType = 'nodebuffer';\n\n  if (Array.isArray(address)) {\n    initAsServerClient.apply(this, address.concat(options));\n  } else {\n    initAsClient.apply(this, [address, protocols, options]);\n  }\n}\n\n/**\n * Inherits from EventEmitter.\n */\nutil.inherits(WebSocket, EventEmitter);\n\n/**\n * Ready States\n */\n[\"CONNECTING\", \"OPEN\", \"CLOSING\", \"CLOSED\"].forEach(function each(state, index) {\n    WebSocket.prototype[state] = WebSocket[state] = index;\n});\n\n/**\n * Gracefully closes the connection, after sending a description message to the server\n *\n * @param {Object} data to be sent to the server\n * @api public\n */\nWebSocket.prototype.close = function close(code, data) {\n  if (this.readyState === WebSocket.CLOSED) return;\n\n  if (this.readyState === WebSocket.CONNECTING) {\n    this.readyState = WebSocket.CLOSED;\n    return;\n  }\n\n  if (this.readyState === WebSocket.CLOSING) {\n    if (this._closeReceived && this._isServer) {\n      this.terminate();\n    }\n    return;\n  }\n\n  var self = this;\n  try {\n    this.readyState = WebSocket.CLOSING;\n    this._closeCode = code;\n    this._closeMessage = data;\n    var mask = !this._isServer;\n    this._sender.close(code, data, mask, function(err) {\n      if (err) self.emit('error', err);\n\n      if (self._closeReceived && self._isServer) {\n        self.terminate();\n      } else {\n        // ensure that the connection is cleaned up even when no response of closing handshake.\n        clearTimeout(self._closeTimer);\n        self._closeTimer = setTimeout(cleanupWebsocketResources.bind(self, true), closeTimeout);\n      }\n    });\n  } catch (e) {\n    this.emit('error', e);\n  }\n};\n\n/**\n * Pause the client stream\n *\n * @api public\n */\nWebSocket.prototype.pause = function pauser() {\n  if (this.readyState !== WebSocket.OPEN) throw new Error('not opened');\n\n  return this._socket.pause();\n};\n\n/**\n * Sends a ping\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\nWebSocket.prototype.ping = function ping(data, options, dontFailWhenClosed) {\n  if (this.readyState !== WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n\n  options = options || {};\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n\n  this._sender.ping(data, options);\n};\n\n/**\n * Sends a pong\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean\n * @param {boolean} dontFailWhenClosed indicates whether or not to throw if the connection isnt open\n * @api public\n */\nWebSocket.prototype.pong = function(data, options, dontFailWhenClosed) {\n  if (this.readyState !== WebSocket.OPEN) {\n    if (dontFailWhenClosed === true) return;\n    throw new Error('not opened');\n  }\n\n  options = options || {};\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n\n  this._sender.pong(data, options);\n};\n\n/**\n * Resume the client stream\n *\n * @api public\n */\nWebSocket.prototype.resume = function resume() {\n  if (this.readyState !== WebSocket.OPEN) throw new Error('not opened');\n\n  return this._socket.resume();\n};\n\n/**\n * Sends a piece of data\n *\n * @param {Object} data to be sent to the server\n * @param {Object} Members - mask: boolean, binary: boolean, compress: boolean\n * @param {function} Optional callback which is executed after the send completes\n * @api public\n */\n\nWebSocket.prototype.send = function send(data, options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n\n  if (this.readyState !== WebSocket.OPEN) {\n    if (typeof cb === 'function') cb(new Error('not opened'));\n    else throw new Error('not opened');\n    return;\n  }\n\n  if (!data) data = '';\n  if (this._queue) {\n    var self = this;\n    this._queue.push(function() { self.send(data, options, cb); });\n    return;\n  }\n\n  options = options || {};\n  options.fin = true;\n\n  if (typeof options.binary === 'undefined') {\n    options.binary = (data instanceof ArrayBuffer || data instanceof Buffer ||\n      data instanceof Uint8Array ||\n      data instanceof Uint16Array ||\n      data instanceof Uint32Array ||\n      data instanceof Int8Array ||\n      data instanceof Int16Array ||\n      data instanceof Int32Array ||\n      data instanceof Float32Array ||\n      data instanceof Float64Array);\n  }\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  if (typeof options.compress === 'undefined') options.compress = true;\n  if (!this.extensions[PerMessageDeflate.extensionName]) {\n    options.compress = false;\n  }\n\n  var readable = typeof stream.Readable === 'function'\n    ? stream.Readable\n    : stream.Stream;\n\n  if (data instanceof readable) {\n    startQueue(this);\n    var self = this;\n\n    sendStream(this, data, options, function send(error) {\n      process.nextTick(function tock() {\n        executeQueueSends(self);\n      });\n\n      if (typeof cb === 'function') cb(error);\n    });\n  } else {\n    this._sender.send(data, options, cb);\n  }\n};\n\n/**\n * Streams data through calls to a user supplied function\n *\n * @param {Object} Members - mask: boolean, binary: boolean, compress: boolean\n * @param {function} 'function (error, send)' which is executed on successive ticks of which send is 'function (data, final)'.\n * @api public\n */\nWebSocket.prototype.stream = function stream(options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = {};\n  }\n\n  var self = this;\n\n  if (typeof cb !== 'function') throw new Error('callback must be provided');\n\n  if (this.readyState !== WebSocket.OPEN) {\n    if (typeof cb === 'function') cb(new Error('not opened'));\n    else throw new Error('not opened');\n    return;\n  }\n\n  if (this._queue) {\n    this._queue.push(function () { self.stream(options, cb); });\n    return;\n  }\n\n  options = options || {};\n\n  if (typeof options.mask === 'undefined') options.mask = !this._isServer;\n  if (typeof options.compress === 'undefined') options.compress = true;\n  if (!this.extensions[PerMessageDeflate.extensionName]) {\n    options.compress = false;\n  }\n\n  startQueue(this);\n\n  function send(data, final) {\n    try {\n      if (self.readyState !== WebSocket.OPEN) throw new Error('not opened');\n      options.fin = final === true;\n      self._sender.send(data, options);\n      if (!final) process.nextTick(cb.bind(null, null, send));\n      else executeQueueSends(self);\n    } catch (e) {\n      if (typeof cb === 'function') cb(e);\n      else {\n        delete self._queue;\n        self.emit('error', e);\n      }\n    }\n  }\n\n  process.nextTick(cb.bind(null, null, send));\n};\n\n/**\n * Immediately shuts down the connection\n *\n * @api public\n */\nWebSocket.prototype.terminate = function terminate() {\n  if (this.readyState === WebSocket.CLOSED) return;\n\n  if (this._socket) {\n    this.readyState = WebSocket.CLOSING;\n\n    // End the connection\n    try { this._socket.end(); }\n    catch (e) {\n      // Socket error during end() call, so just destroy it right now\n      cleanupWebsocketResources.call(this, true);\n      return;\n    }\n\n    // Add a timeout to ensure that the connection is completely\n    // cleaned up within 30 seconds, even if the clean close procedure\n    // fails for whatever reason\n    // First cleanup any pre-existing timeout from an earlier \"terminate\" call,\n    // if one exists.  Otherwise terminate calls in quick succession will leak timeouts\n    // and hold the program open for `closeTimout` time.\n    if (this._closeTimer) { clearTimeout(this._closeTimer); }\n    this._closeTimer = setTimeout(cleanupWebsocketResources.bind(this, true), closeTimeout);\n  } else if (this.readyState === WebSocket.CONNECTING) {\n    cleanupWebsocketResources.call(this, true);\n  }\n};\n\n/**\n * Expose bufferedAmount\n *\n * @api public\n */\nObject.defineProperty(WebSocket.prototype, 'bufferedAmount', {\n  get: function get() {\n    var amount = 0;\n    if (this._socket) {\n      amount = this._socket.bufferSize || 0;\n    }\n    return amount;\n  }\n});\n\n/**\n * Expose binaryType\n *\n * This deviates from the W3C interface since ws doesn't support the required\n * default \"blob\" type (instead we define a custom \"nodebuffer\" type).\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nObject.defineProperty(WebSocket.prototype, 'binaryType', {\n  get: function get() {\n    return this._binaryType;\n  },\n  set: function set(type) {\n    if (type === 'arraybuffer' || type === 'nodebuffer')\n      this._binaryType = type;\n    else\n      throw new SyntaxError('unsupported binaryType: must be either \"nodebuffer\" or \"arraybuffer\"');\n  }\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using function members.\n *\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n['open', 'error', 'close', 'message'].forEach(function(method) {\n  Object.defineProperty(WebSocket.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? (listener._listener ? listener._listener : listener) : undefined;\n    },\n\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @returns {Mixed} the set function or undefined\n     * @api public\n     */\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nWebSocket.prototype.addEventListener = function(method, listener) {\n  var target = this;\n\n  function onMessage (data, flags) {\n    if (flags.binary && this.binaryType === 'arraybuffer')\n        data = new Uint8Array(data).buffer;\n    listener.call(target, new MessageEvent(data, !!flags.binary, target));\n  }\n\n  function onClose (code, message) {\n    listener.call(target, new CloseEvent(code, message, target));\n  }\n\n  function onError (event) {\n    event.type = 'error';\n    event.target = target;\n    listener.call(target, event);\n  }\n\n  function onOpen () {\n    listener.call(target, new OpenEvent(target));\n  }\n\n  if (typeof listener === 'function') {\n    if (method === 'message') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onMessage._listener = listener;\n      this.on(method, onMessage);\n    } else if (method === 'close') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onClose._listener = listener;\n      this.on(method, onClose);\n    } else if (method === 'error') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onError._listener = listener;\n      this.on(method, onError);\n    } else if (method === 'open') {\n      // store a reference so we can return the original function from the\n      // addEventListener hook\n      onOpen._listener = listener;\n      this.on(method, onOpen);\n    } else {\n      this.on(method, listener);\n    }\n  }\n};\n\nmodule.exports = WebSocket;\nmodule.exports.buildHostHeader = buildHostHeader\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction MessageEvent(dataArg, isBinary, target) {\n  this.type = 'message';\n  this.data = dataArg;\n  this.target = target;\n  this.binary = isBinary; // non-standard.\n}\n\n/**\n * W3C CloseEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction CloseEvent(code, reason, target) {\n  this.type = 'close';\n  this.wasClean = (typeof code === 'undefined' || code === 1000);\n  this.code = code;\n  this.reason = reason;\n  this.target = target;\n}\n\n/**\n * W3C OpenEvent\n *\n * @see http://www.w3.org/TR/html5/comms.html\n * @constructor\n * @api private\n */\nfunction OpenEvent(target) {\n  this.type = 'open';\n  this.target = target;\n}\n\n// Append port number to Host header, only if specified in the url\n// and non-default\nfunction buildHostHeader(isSecure, hostname, port) {\n  var headerHost = hostname;\n  if (hostname) {\n    if ((isSecure && (port != 443)) || (!isSecure && (port != 80))){\n      headerHost = headerHost + ':' + port;\n    }\n  }\n  return headerHost;\n}\n\n/**\n * Entirely private apis,\n * which may or may not be bound to a sepcific WebSocket instance.\n */\nfunction initAsServerClient(req, socket, upgradeHead, options) {\n  options = new Options({\n    protocolVersion: protocolVersion,\n    protocol: null,\n    extensions: {},\n    maxPayload: 0\n  }).merge(options);\n\n  // expose state properties\n  this.protocol = options.value.protocol;\n  this.protocolVersion = options.value.protocolVersion;\n  this.extensions = options.value.extensions;\n  this.supports.binary = (this.protocolVersion !== 'hixie-76');\n  this.upgradeReq = req;\n  this.readyState = WebSocket.CONNECTING;\n  this._isServer = true;\n  this.maxPayload = options.value.maxPayload;\n  // establish connection\n  if (options.value.protocolVersion === 'hixie-76') {\n    establishConnection.call(this, ReceiverHixie, SenderHixie, socket, upgradeHead);\n  } else {\n    establishConnection.call(this, Receiver, Sender, socket, upgradeHead);\n  }\n}\n\nfunction initAsClient(address, protocols, options) {\n  options = new Options({\n    origin: null,\n    protocolVersion: protocolVersion,\n    host: null,\n    headers: null,\n    protocol: protocols.join(','),\n    agent: null,\n\n    // ssl-related options\n    pfx: null,\n    key: null,\n    passphrase: null,\n    cert: null,\n    ca: null,\n    ciphers: null,\n    rejectUnauthorized: null,\n    perMessageDeflate: true,\n    localAddress: null\n  }).merge(options);\n\n  if (options.value.protocolVersion !== 8 && options.value.protocolVersion !== 13) {\n    throw new Error('unsupported protocol version');\n  }\n\n  // verify URL and establish http class\n  var serverUrl = url.parse(address);\n  var isUnixSocket = serverUrl.protocol === 'ws+unix:';\n  if (!serverUrl.host && !isUnixSocket) throw new Error('invalid url');\n  var isSecure = serverUrl.protocol === 'wss:' || serverUrl.protocol === 'https:';\n  var httpObj = isSecure ? https : http;\n  var port = serverUrl.port || (isSecure ? 443 : 80);\n  var auth = serverUrl.auth;\n\n  // prepare extensions\n  var extensionsOffer = {};\n  var perMessageDeflate;\n  if (options.value.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(typeof options.value.perMessageDeflate !== true ? options.value.perMessageDeflate : {}, false);\n    extensionsOffer[PerMessageDeflate.extensionName] = perMessageDeflate.offer();\n  }\n\n  // expose state properties\n  this._isServer = false;\n  this.url = address;\n  this.protocolVersion = options.value.protocolVersion;\n  this.supports.binary = (this.protocolVersion !== 'hixie-76');\n\n  // begin handshake\n  var key = new Buffer(options.value.protocolVersion + '-' + Date.now()).toString('base64');\n  var shasum = crypto.createHash('sha1');\n  shasum.update(key + '258EAFA5-E914-47DA-95CA-C5AB0DC85B11');\n  var expectedServerKey = shasum.digest('base64');\n\n  var agent = options.value.agent;\n\n  var headerHost = buildHostHeader(isSecure, serverUrl.hostname, port)\n\n  var requestOptions = {\n    port: port,\n    host: serverUrl.hostname,\n    headers: {\n      'Connection': 'Upgrade',\n      'Upgrade': 'websocket',\n      'Host': headerHost,\n      'Sec-WebSocket-Version': options.value.protocolVersion,\n      'Sec-WebSocket-Key': key\n    }\n  };\n\n  // If we have basic auth.\n  if (auth) {\n    requestOptions.headers.Authorization = 'Basic ' + new Buffer(auth).toString('base64');\n  }\n\n  if (options.value.protocol) {\n    requestOptions.headers['Sec-WebSocket-Protocol'] = options.value.protocol;\n  }\n\n  if (options.value.host) {\n    requestOptions.headers.Host = options.value.host;\n  }\n\n  if (options.value.headers) {\n    for (var header in options.value.headers) {\n       if (options.value.headers.hasOwnProperty(header)) {\n        requestOptions.headers[header] = options.value.headers[header];\n       }\n    }\n  }\n\n  if (Object.keys(extensionsOffer).length) {\n    requestOptions.headers['Sec-WebSocket-Extensions'] = Extensions.format(extensionsOffer);\n  }\n\n  if (options.isDefinedAndNonNull('pfx')\n   || options.isDefinedAndNonNull('key')\n   || options.isDefinedAndNonNull('passphrase')\n   || options.isDefinedAndNonNull('cert')\n   || options.isDefinedAndNonNull('ca')\n   || options.isDefinedAndNonNull('ciphers')\n   || options.isDefinedAndNonNull('rejectUnauthorized')) {\n\n    if (options.isDefinedAndNonNull('pfx')) requestOptions.pfx = options.value.pfx;\n    if (options.isDefinedAndNonNull('key')) requestOptions.key = options.value.key;\n    if (options.isDefinedAndNonNull('passphrase')) requestOptions.passphrase = options.value.passphrase;\n    if (options.isDefinedAndNonNull('cert')) requestOptions.cert = options.value.cert;\n    if (options.isDefinedAndNonNull('ca')) requestOptions.ca = options.value.ca;\n    if (options.isDefinedAndNonNull('ciphers')) requestOptions.ciphers = options.value.ciphers;\n    if (options.isDefinedAndNonNull('rejectUnauthorized')) requestOptions.rejectUnauthorized = options.value.rejectUnauthorized;\n\n    if (!agent) {\n        // global agent ignores client side certificates\n        agent = new httpObj.Agent(requestOptions);\n    }\n  }\n\n  requestOptions.path = serverUrl.path || '/';\n\n  if (agent) {\n    requestOptions.agent = agent;\n  }\n\n  if (isUnixSocket) {\n    requestOptions.socketPath = serverUrl.pathname;\n  }\n\n  if (options.value.localAddress) {\n    requestOptions.localAddress = options.value.localAddress;\n  }\n\n  if (options.value.origin) {\n    if (options.value.protocolVersion < 13) requestOptions.headers['Sec-WebSocket-Origin'] = options.value.origin;\n    else requestOptions.headers.Origin = options.value.origin;\n  }\n\n  var self = this;\n  var req = httpObj.request(requestOptions);\n\n  req.on('error', function onerror(error) {\n    self.emit('error', error);\n    cleanupWebsocketResources.call(self, error);\n  });\n\n  req.once('response', function response(res) {\n    var error;\n\n    if (!self.emit('unexpected-response', req, res)) {\n      error = new Error('unexpected server response (' + res.statusCode + ')');\n      req.abort();\n      self.emit('error', error);\n    }\n\n    cleanupWebsocketResources.call(self, error);\n  });\n\n  req.once('upgrade', function upgrade(res, socket, upgradeHead) {\n    if (self.readyState === WebSocket.CLOSED) {\n      // client closed before server accepted connection\n      self.emit('close');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n\n    var serverKey = res.headers['sec-websocket-accept'];\n    if (typeof serverKey === 'undefined' || serverKey !== expectedServerKey) {\n      self.emit('error', 'invalid server key');\n      self.removeAllListeners();\n      socket.end();\n      return;\n    }\n\n    var serverProt = res.headers['sec-websocket-protocol'];\n    var protList = (options.value.protocol || \"\").split(/, */);\n    var protError = null;\n\n    if (!options.value.protocol && serverProt) {\n      protError = 'server sent a subprotocol even though none requested';\n    } else if (options.value.protocol && !serverProt) {\n      protError = 'server sent no subprotocol even though requested';\n    } else if (serverProt && protList.indexOf(serverProt) === -1) {\n      protError = 'server responded with an invalid protocol';\n    }\n\n    if (protError) {\n      self.emit('error', protError);\n      self.removeAllListeners();\n      socket.end();\n      return;\n    } else if (serverProt) {\n      self.protocol = serverProt;\n    }\n\n    var serverExtensions = Extensions.parse(res.headers['sec-websocket-extensions']);\n    if (perMessageDeflate && serverExtensions[PerMessageDeflate.extensionName]) {\n      try {\n        perMessageDeflate.accept(serverExtensions[PerMessageDeflate.extensionName]);\n      } catch (err) {\n        self.emit('error', 'invalid extension parameter');\n        self.removeAllListeners();\n        socket.end();\n        return;\n      }\n      self.extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n    }\n\n    establishConnection.call(self, Receiver, Sender, socket, upgradeHead);\n\n    // perform cleanup on http resources\n    req.removeAllListeners();\n    req = null;\n    agent = null;\n  });\n\n  req.end();\n  this.readyState = WebSocket.CONNECTING;\n}\n\nfunction establishConnection(ReceiverClass, SenderClass, socket, upgradeHead) {\n  var ultron = this._ultron = new Ultron(socket)\n    , called = false\n    , self = this;\n\n  socket.setTimeout(0);\n  socket.setNoDelay(true);\n\n  this._receiver = new ReceiverClass(this.extensions,this.maxPayload);\n  this._socket = socket;\n\n  // socket cleanup handlers\n  ultron.on('end', cleanupWebsocketResources.bind(this));\n  ultron.on('close', cleanupWebsocketResources.bind(this));\n  ultron.on('error', cleanupWebsocketResources.bind(this));\n\n  // ensure that the upgradeHead is added to the receiver\n  function firstHandler(data) {\n    if (called || self.readyState === WebSocket.CLOSED) return;\n\n    called = true;\n    socket.removeListener('data', firstHandler);\n    ultron.on('data', realHandler);\n\n    if (upgradeHead && upgradeHead.length > 0) {\n      realHandler(upgradeHead);\n      upgradeHead = null;\n    }\n\n    if (data) realHandler(data);\n  }\n\n  // subsequent packets are pushed straight to the receiver\n  function realHandler(data) {\n    self.bytesReceived += data.length;\n    self._receiver.add(data);\n  }\n\n  ultron.on('data', firstHandler);\n\n  // if data was passed along with the http upgrade,\n  // this will schedule a push of that on to the receiver.\n  // this has to be done on next tick, since the caller\n  // hasn't had a chance to set event handlers on this client\n  // object yet.\n  process.nextTick(firstHandler);\n\n  // receiver event handlers\n  self._receiver.ontext = function ontext(data, flags) {\n    flags = flags || {};\n\n    self.emit('message', data, flags);\n  };\n\n  self._receiver.onbinary = function onbinary(data, flags) {\n    flags = flags || {};\n\n    flags.binary = true;\n    self.emit('message', data, flags);\n  };\n\n  self._receiver.onping = function onping(data, flags) {\n    flags = flags || {};\n\n    self.pong(data, {\n      mask: !self._isServer,\n      binary: flags.binary === true\n    }, true);\n\n    self.emit('ping', data, flags);\n  };\n\n  self._receiver.onpong = function onpong(data, flags) {\n    self.emit('pong', data, flags || {});\n  };\n\n  self._receiver.onclose = function onclose(code, data, flags) {\n    flags = flags || {};\n\n    self._closeReceived = true;\n    self.close(code, data);\n  };\n\n  self._receiver.onerror = function onerror(reason, errorCode) {\n    // close the connection when the receiver reports a HyBi error code\n    self.close(typeof errorCode !== 'undefined' ? errorCode : 1002, '');\n    self.emit('error', (reason instanceof Error) ? reason : (new Error(reason)));\n  };\n\n  // finalize the client\n  this._sender = new SenderClass(socket, this.extensions);\n  this._sender.on('error', function onerror(error) {\n    self.close(1002, '');\n    self.emit('error', error);\n  });\n\n  this.readyState = WebSocket.OPEN;\n  this.emit('open');\n}\n\nfunction startQueue(instance) {\n  instance._queue = instance._queue || [];\n}\n\nfunction executeQueueSends(instance) {\n  var queue = instance._queue;\n  if (typeof queue === 'undefined') return;\n\n  delete instance._queue;\n  for (var i = 0, l = queue.length; i < l; ++i) {\n    queue[i]();\n  }\n}\n\nfunction sendStream(instance, stream, options, cb) {\n  stream.on('data', function incoming(data) {\n    if (instance.readyState !== WebSocket.OPEN) {\n      if (typeof cb === 'function') cb(new Error('not opened'));\n      else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n\n    options.fin = false;\n    instance._sender.send(data, options);\n  });\n\n  stream.on('end', function end() {\n    if (instance.readyState !== WebSocket.OPEN) {\n      if (typeof cb === 'function') cb(new Error('not opened'));\n      else {\n        delete instance._queue;\n        instance.emit('error', new Error('not opened'));\n      }\n      return;\n    }\n\n    options.fin = true;\n    instance._sender.send(null, options);\n\n    if (typeof cb === 'function') cb(null);\n  });\n}\n\nfunction cleanupWebsocketResources(error) {\n  if (this.readyState === WebSocket.CLOSED) return;\n\n  this.readyState = WebSocket.CLOSED;\n\n  clearTimeout(this._closeTimer);\n  this._closeTimer = null;\n\n  // If the connection was closed abnormally (with an error), or if\n  // the close control frame was not received then the close code\n  // must default to 1006.\n  if (error || !this._closeReceived) {\n    this._closeCode = 1006;\n  }\n  this.emit('close', this._closeCode || 1000, this._closeMessage || '');\n\n  if (this._socket) {\n    if (this._ultron) this._ultron.destroy();\n    this._socket.on('error', function onerror() {\n      try { this.destroy(); }\n      catch (e) {}\n    });\n\n    try {\n      if (!error) this._socket.end();\n      else this._socket.destroy();\n    } catch (e) { /* Ignore termination errors */ }\n\n    this._socket = null;\n    this._ultron = null;\n  }\n\n  if (this._sender) {\n    this._sender.removeAllListeners();\n    this._sender = null;\n  }\n\n  if (this._receiver) {\n    this._receiver.cleanup();\n    this._receiver = null;\n  }\n\n  if (this.extensions[PerMessageDeflate.extensionName]) {\n    this.extensions[PerMessageDeflate.extensionName].cleanup();\n  }\n\n  this.extensions = null;\n\n  this.removeAllListeners();\n  this.on('error', function onerror() {}); // catch all errors after this\n  delete this._queue;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}
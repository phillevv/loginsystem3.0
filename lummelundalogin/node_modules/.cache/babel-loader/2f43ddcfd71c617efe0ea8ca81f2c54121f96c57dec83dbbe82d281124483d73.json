{"ast":null,"code":"/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar util = require('util');\n\n/**\n * State constants\n */\n\nvar EMPTY = 0,\n  BODY = 1;\nvar BINARYLENGTH = 2,\n  BINARYBODY = 3;\n\n/**\n * Hixie Receiver implementation\n */\n\nfunction Receiver() {\n  if (this instanceof Receiver === false) {\n    throw new TypeError(\"Classes can't be function-called\");\n  }\n  this.state = EMPTY;\n  this.buffers = [];\n  this.messageEnd = -1;\n  this.spanLength = 0;\n  this.dead = false;\n  this.onerror = function () {};\n  this.ontext = function () {};\n  this.onbinary = function () {};\n  this.onclose = function () {};\n  this.onping = function () {};\n  this.onpong = function () {};\n}\nmodule.exports = Receiver;\n\n/**\n * Add new data to the parser.\n *\n * @api public\n */\n\nReceiver.prototype.add = function (data) {\n  if (this.dead) return;\n  var self = this;\n  function doAdd() {\n    if (self.state === EMPTY) {\n      if (data.length == 2 && data[0] == 0xFF && data[1] == 0x00) {\n        self.reset();\n        self.onclose();\n        return;\n      }\n      if (data[0] === 0x80) {\n        self.messageEnd = 0;\n        self.state = BINARYLENGTH;\n        data = data.slice(1);\n      } else {\n        if (data[0] !== 0x00) {\n          self.error('payload must start with 0x00 byte', true);\n          return;\n        }\n        data = data.slice(1);\n        self.state = BODY;\n      }\n    }\n    if (self.state === BINARYLENGTH) {\n      var i = 0;\n      while (i < data.length && data[i] & 0x80) {\n        self.messageEnd = 128 * self.messageEnd + (data[i] & 0x7f);\n        ++i;\n      }\n      if (i < data.length) {\n        self.messageEnd = 128 * self.messageEnd + (data[i] & 0x7f);\n        self.state = BINARYBODY;\n        ++i;\n      }\n      if (i > 0) data = data.slice(i);\n    }\n    if (self.state === BINARYBODY) {\n      var dataleft = self.messageEnd - self.spanLength;\n      if (data.length >= dataleft) {\n        // consume the whole buffer to finish the frame\n        self.buffers.push(data);\n        self.spanLength += dataleft;\n        self.messageEnd = dataleft;\n        return self.parse();\n      }\n      // frame's not done even if we consume it all\n      self.buffers.push(data);\n      self.spanLength += data.length;\n      return;\n    }\n    self.buffers.push(data);\n    if ((self.messageEnd = bufferIndex(data, 0xFF)) != -1) {\n      self.spanLength += self.messageEnd;\n      return self.parse();\n    } else self.spanLength += data.length;\n  }\n  while (data) data = doAdd();\n};\n\n/**\n * Releases all resources used by the receiver.\n *\n * @api public\n */\n\nReceiver.prototype.cleanup = function () {\n  this.dead = true;\n  this.state = EMPTY;\n  this.buffers = [];\n};\n\n/**\n * Process buffered data.\n *\n * @api public\n */\n\nReceiver.prototype.parse = function () {\n  var output = new Buffer(this.spanLength);\n  var outputIndex = 0;\n  for (var bi = 0, bl = this.buffers.length; bi < bl - 1; ++bi) {\n    var buffer = this.buffers[bi];\n    buffer.copy(output, outputIndex);\n    outputIndex += buffer.length;\n  }\n  var lastBuffer = this.buffers[this.buffers.length - 1];\n  if (this.messageEnd > 0) lastBuffer.copy(output, outputIndex, 0, this.messageEnd);\n  if (this.state !== BODY) --this.messageEnd;\n  var tail = null;\n  if (this.messageEnd < lastBuffer.length - 1) {\n    tail = lastBuffer.slice(this.messageEnd + 1);\n  }\n  this.reset();\n  this.ontext(output.toString('utf8'));\n  return tail;\n};\n\n/**\n * Handles an error\n *\n * @api private\n */\n\nReceiver.prototype.error = function (reason, terminate) {\n  if (this.dead) return;\n  this.reset();\n  if (typeof reason == 'string') {\n    this.onerror(new Error(reason), terminate);\n  } else if (reason.constructor == Error) {\n    this.onerror(reason, terminate);\n  } else {\n    this.onerror(new Error(\"An error occured\"), terminate);\n  }\n  return this;\n};\n\n/**\n * Reset parser state\n *\n * @api private\n */\n\nReceiver.prototype.reset = function (reason) {\n  if (this.dead) return;\n  this.state = EMPTY;\n  this.buffers = [];\n  this.messageEnd = -1;\n  this.spanLength = 0;\n};\n\n/**\n * Internal api\n */\n\nfunction bufferIndex(buffer, byte) {\n  for (var i = 0, l = buffer.length; i < l; ++i) {\n    if (buffer[i] === byte) return i;\n  }\n  return -1;\n}","map":{"version":3,"names":["util","require","EMPTY","BODY","BINARYLENGTH","BINARYBODY","Receiver","TypeError","state","buffers","messageEnd","spanLength","dead","onerror","ontext","onbinary","onclose","onping","onpong","module","exports","prototype","add","data","self","doAdd","length","reset","slice","error","i","dataleft","push","parse","bufferIndex","cleanup","output","Buffer","outputIndex","bi","bl","buffer","copy","lastBuffer","tail","toString","reason","terminate","Error","constructor","byte","l"],"sources":["C:/Users/walle/Documents/lummelundalogin/lummelundalogin/node_modules/engine.io/node_modules/ws/lib/Receiver.hixie.js"],"sourcesContent":["/*!\n * ws: a node.js websocket client\n * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>\n * MIT Licensed\n */\n\nvar util = require('util');\n\n/**\n * State constants\n */\n\nvar EMPTY = 0\n  , BODY = 1;\nvar BINARYLENGTH = 2\n  , BINARYBODY = 3;\n\n/**\n * Hixie Receiver implementation\n */\n\nfunction Receiver () {\n  if (this instanceof Receiver === false) {\n    throw new TypeError(\"Classes can't be function-called\");\n  }\n\n  this.state = EMPTY;\n  this.buffers = [];\n  this.messageEnd = -1;\n  this.spanLength = 0;\n  this.dead = false;\n\n  this.onerror = function() {};\n  this.ontext = function() {};\n  this.onbinary = function() {};\n  this.onclose = function() {};\n  this.onping = function() {};\n  this.onpong = function() {};\n}\n\nmodule.exports = Receiver;\n\n/**\n * Add new data to the parser.\n *\n * @api public\n */\n\nReceiver.prototype.add = function(data) {\n  if (this.dead) return;\n  var self = this;\n  function doAdd() {\n    if (self.state === EMPTY) {\n      if (data.length == 2 && data[0] == 0xFF && data[1] == 0x00) {\n        self.reset();\n        self.onclose();\n        return;\n      }\n      if (data[0] === 0x80) {\n        self.messageEnd = 0;\n        self.state = BINARYLENGTH;\n        data = data.slice(1);\n      } else {\n\n      if (data[0] !== 0x00) {\n        self.error('payload must start with 0x00 byte', true);\n        return;\n      }\n      data = data.slice(1);\n      self.state = BODY;\n\n      }\n    }\n    if (self.state === BINARYLENGTH) {\n      var i = 0;\n      while ((i < data.length) && (data[i] & 0x80)) {\n        self.messageEnd = 128 * self.messageEnd + (data[i] & 0x7f);\n        ++i;\n      }\n      if (i < data.length) {\n        self.messageEnd = 128 * self.messageEnd + (data[i] & 0x7f);\n        self.state = BINARYBODY;\n        ++i;\n      }\n      if (i > 0)\n        data = data.slice(i);\n    }\n    if (self.state === BINARYBODY) {\n      var dataleft = self.messageEnd - self.spanLength;\n      if (data.length >= dataleft) {\n        // consume the whole buffer to finish the frame\n        self.buffers.push(data);\n        self.spanLength += dataleft;\n        self.messageEnd = dataleft;\n        return self.parse();\n      }\n      // frame's not done even if we consume it all\n      self.buffers.push(data);\n      self.spanLength += data.length;\n      return;\n    }\n    self.buffers.push(data);\n    if ((self.messageEnd = bufferIndex(data, 0xFF)) != -1) {\n      self.spanLength += self.messageEnd;\n      return self.parse();\n    }\n    else self.spanLength += data.length;\n  }\n  while(data) data = doAdd();\n};\n\n/**\n * Releases all resources used by the receiver.\n *\n * @api public\n */\n\nReceiver.prototype.cleanup = function() {\n  this.dead = true;\n  this.state = EMPTY;\n  this.buffers = [];\n};\n\n/**\n * Process buffered data.\n *\n * @api public\n */\n\nReceiver.prototype.parse = function() {\n  var output = new Buffer(this.spanLength);\n  var outputIndex = 0;\n  for (var bi = 0, bl = this.buffers.length; bi < bl - 1; ++bi) {\n    var buffer = this.buffers[bi];\n    buffer.copy(output, outputIndex);\n    outputIndex += buffer.length;\n  }\n  var lastBuffer = this.buffers[this.buffers.length - 1];\n  if (this.messageEnd > 0) lastBuffer.copy(output, outputIndex, 0, this.messageEnd);\n  if (this.state !== BODY) --this.messageEnd;\n  var tail = null;\n  if (this.messageEnd < lastBuffer.length - 1) {\n    tail = lastBuffer.slice(this.messageEnd + 1);\n  }\n  this.reset();\n  this.ontext(output.toString('utf8'));\n  return tail;\n};\n\n/**\n * Handles an error\n *\n * @api private\n */\n\nReceiver.prototype.error = function (reason, terminate) {\n  if (this.dead) return;\n  this.reset();\n  if(typeof reason == 'string'){\n    this.onerror(new Error(reason), terminate);\n  }\n  else if(reason.constructor == Error){\n    this.onerror(reason, terminate);\n  }\n  else{\n    this.onerror(new Error(\"An error occured\"),terminate);\n  }\n  return this;\n};\n\n/**\n * Reset parser state\n *\n * @api private\n */\n\nReceiver.prototype.reset = function (reason) {\n  if (this.dead) return;\n  this.state = EMPTY;\n  this.buffers = [];\n  this.messageEnd = -1;\n  this.spanLength = 0;\n};\n\n/**\n * Internal api\n */\n\nfunction bufferIndex(buffer, byte) {\n  for (var i = 0, l = buffer.length; i < l; ++i) {\n    if (buffer[i] === byte) return i;\n  }\n  return -1;\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;;AAE1B;AACA;AACA;;AAEA,IAAIC,KAAK,GAAG,CAAC;EACTC,IAAI,GAAG,CAAC;AACZ,IAAIC,YAAY,GAAG,CAAC;EAChBC,UAAU,GAAG,CAAC;;AAElB;AACA;AACA;;AAEA,SAASC,QAAQA,CAAA,EAAI;EACnB,IAAI,IAAI,YAAYA,QAAQ,KAAK,KAAK,EAAE;IACtC,MAAM,IAAIC,SAAS,CAAC,kCAAkC,CAAC;EACzD;EAEA,IAAI,CAACC,KAAK,GAAGN,KAAK;EAClB,IAAI,CAACO,OAAO,GAAG,EAAE;EACjB,IAAI,CAACC,UAAU,GAAG,CAAC,CAAC;EACpB,IAAI,CAACC,UAAU,GAAG,CAAC;EACnB,IAAI,CAACC,IAAI,GAAG,KAAK;EAEjB,IAAI,CAACC,OAAO,GAAG,YAAW,CAAC,CAAC;EAC5B,IAAI,CAACC,MAAM,GAAG,YAAW,CAAC,CAAC;EAC3B,IAAI,CAACC,QAAQ,GAAG,YAAW,CAAC,CAAC;EAC7B,IAAI,CAACC,OAAO,GAAG,YAAW,CAAC,CAAC;EAC5B,IAAI,CAACC,MAAM,GAAG,YAAW,CAAC,CAAC;EAC3B,IAAI,CAACC,MAAM,GAAG,YAAW,CAAC,CAAC;AAC7B;AAEAC,MAAM,CAACC,OAAO,GAAGd,QAAQ;;AAEzB;AACA;AACA;AACA;AACA;;AAEAA,QAAQ,CAACe,SAAS,CAACC,GAAG,GAAG,UAASC,IAAI,EAAE;EACtC,IAAI,IAAI,CAACX,IAAI,EAAE;EACf,IAAIY,IAAI,GAAG,IAAI;EACf,SAASC,KAAKA,CAAA,EAAG;IACf,IAAID,IAAI,CAAChB,KAAK,KAAKN,KAAK,EAAE;MACxB,IAAIqB,IAAI,CAACG,MAAM,IAAI,CAAC,IAAIH,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,IAAIA,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE;QAC1DC,IAAI,CAACG,KAAK,CAAC,CAAC;QACZH,IAAI,CAACR,OAAO,CAAC,CAAC;QACd;MACF;MACA,IAAIO,IAAI,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;QACpBC,IAAI,CAACd,UAAU,GAAG,CAAC;QACnBc,IAAI,CAAChB,KAAK,GAAGJ,YAAY;QACzBmB,IAAI,GAAGA,IAAI,CAACK,KAAK,CAAC,CAAC,CAAC;MACtB,CAAC,MAAM;QAEP,IAAIL,IAAI,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;UACpBC,IAAI,CAACK,KAAK,CAAC,mCAAmC,EAAE,IAAI,CAAC;UACrD;QACF;QACAN,IAAI,GAAGA,IAAI,CAACK,KAAK,CAAC,CAAC,CAAC;QACpBJ,IAAI,CAAChB,KAAK,GAAGL,IAAI;MAEjB;IACF;IACA,IAAIqB,IAAI,CAAChB,KAAK,KAAKJ,YAAY,EAAE;MAC/B,IAAI0B,CAAC,GAAG,CAAC;MACT,OAAQA,CAAC,GAAGP,IAAI,CAACG,MAAM,IAAMH,IAAI,CAACO,CAAC,CAAC,GAAG,IAAK,EAAE;QAC5CN,IAAI,CAACd,UAAU,GAAG,GAAG,GAAGc,IAAI,CAACd,UAAU,IAAIa,IAAI,CAACO,CAAC,CAAC,GAAG,IAAI,CAAC;QAC1D,EAAEA,CAAC;MACL;MACA,IAAIA,CAAC,GAAGP,IAAI,CAACG,MAAM,EAAE;QACnBF,IAAI,CAACd,UAAU,GAAG,GAAG,GAAGc,IAAI,CAACd,UAAU,IAAIa,IAAI,CAACO,CAAC,CAAC,GAAG,IAAI,CAAC;QAC1DN,IAAI,CAAChB,KAAK,GAAGH,UAAU;QACvB,EAAEyB,CAAC;MACL;MACA,IAAIA,CAAC,GAAG,CAAC,EACPP,IAAI,GAAGA,IAAI,CAACK,KAAK,CAACE,CAAC,CAAC;IACxB;IACA,IAAIN,IAAI,CAAChB,KAAK,KAAKH,UAAU,EAAE;MAC7B,IAAI0B,QAAQ,GAAGP,IAAI,CAACd,UAAU,GAAGc,IAAI,CAACb,UAAU;MAChD,IAAIY,IAAI,CAACG,MAAM,IAAIK,QAAQ,EAAE;QAC3B;QACAP,IAAI,CAACf,OAAO,CAACuB,IAAI,CAACT,IAAI,CAAC;QACvBC,IAAI,CAACb,UAAU,IAAIoB,QAAQ;QAC3BP,IAAI,CAACd,UAAU,GAAGqB,QAAQ;QAC1B,OAAOP,IAAI,CAACS,KAAK,CAAC,CAAC;MACrB;MACA;MACAT,IAAI,CAACf,OAAO,CAACuB,IAAI,CAACT,IAAI,CAAC;MACvBC,IAAI,CAACb,UAAU,IAAIY,IAAI,CAACG,MAAM;MAC9B;IACF;IACAF,IAAI,CAACf,OAAO,CAACuB,IAAI,CAACT,IAAI,CAAC;IACvB,IAAI,CAACC,IAAI,CAACd,UAAU,GAAGwB,WAAW,CAACX,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;MACrDC,IAAI,CAACb,UAAU,IAAIa,IAAI,CAACd,UAAU;MAClC,OAAOc,IAAI,CAACS,KAAK,CAAC,CAAC;IACrB,CAAC,MACIT,IAAI,CAACb,UAAU,IAAIY,IAAI,CAACG,MAAM;EACrC;EACA,OAAMH,IAAI,EAAEA,IAAI,GAAGE,KAAK,CAAC,CAAC;AAC5B,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEAnB,QAAQ,CAACe,SAAS,CAACc,OAAO,GAAG,YAAW;EACtC,IAAI,CAACvB,IAAI,GAAG,IAAI;EAChB,IAAI,CAACJ,KAAK,GAAGN,KAAK;EAClB,IAAI,CAACO,OAAO,GAAG,EAAE;AACnB,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEAH,QAAQ,CAACe,SAAS,CAACY,KAAK,GAAG,YAAW;EACpC,IAAIG,MAAM,GAAG,IAAIC,MAAM,CAAC,IAAI,CAAC1B,UAAU,CAAC;EACxC,IAAI2B,WAAW,GAAG,CAAC;EACnB,KAAK,IAAIC,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAG,IAAI,CAAC/B,OAAO,CAACiB,MAAM,EAAEa,EAAE,GAAGC,EAAE,GAAG,CAAC,EAAE,EAAED,EAAE,EAAE;IAC5D,IAAIE,MAAM,GAAG,IAAI,CAAChC,OAAO,CAAC8B,EAAE,CAAC;IAC7BE,MAAM,CAACC,IAAI,CAACN,MAAM,EAAEE,WAAW,CAAC;IAChCA,WAAW,IAAIG,MAAM,CAACf,MAAM;EAC9B;EACA,IAAIiB,UAAU,GAAG,IAAI,CAAClC,OAAO,CAAC,IAAI,CAACA,OAAO,CAACiB,MAAM,GAAG,CAAC,CAAC;EACtD,IAAI,IAAI,CAAChB,UAAU,GAAG,CAAC,EAAEiC,UAAU,CAACD,IAAI,CAACN,MAAM,EAAEE,WAAW,EAAE,CAAC,EAAE,IAAI,CAAC5B,UAAU,CAAC;EACjF,IAAI,IAAI,CAACF,KAAK,KAAKL,IAAI,EAAE,EAAE,IAAI,CAACO,UAAU;EAC1C,IAAIkC,IAAI,GAAG,IAAI;EACf,IAAI,IAAI,CAAClC,UAAU,GAAGiC,UAAU,CAACjB,MAAM,GAAG,CAAC,EAAE;IAC3CkB,IAAI,GAAGD,UAAU,CAACf,KAAK,CAAC,IAAI,CAAClB,UAAU,GAAG,CAAC,CAAC;EAC9C;EACA,IAAI,CAACiB,KAAK,CAAC,CAAC;EACZ,IAAI,CAACb,MAAM,CAACsB,MAAM,CAACS,QAAQ,CAAC,MAAM,CAAC,CAAC;EACpC,OAAOD,IAAI;AACb,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEAtC,QAAQ,CAACe,SAAS,CAACQ,KAAK,GAAG,UAAUiB,MAAM,EAAEC,SAAS,EAAE;EACtD,IAAI,IAAI,CAACnC,IAAI,EAAE;EACf,IAAI,CAACe,KAAK,CAAC,CAAC;EACZ,IAAG,OAAOmB,MAAM,IAAI,QAAQ,EAAC;IAC3B,IAAI,CAACjC,OAAO,CAAC,IAAImC,KAAK,CAACF,MAAM,CAAC,EAAEC,SAAS,CAAC;EAC5C,CAAC,MACI,IAAGD,MAAM,CAACG,WAAW,IAAID,KAAK,EAAC;IAClC,IAAI,CAACnC,OAAO,CAACiC,MAAM,EAAEC,SAAS,CAAC;EACjC,CAAC,MACG;IACF,IAAI,CAAClC,OAAO,CAAC,IAAImC,KAAK,CAAC,kBAAkB,CAAC,EAACD,SAAS,CAAC;EACvD;EACA,OAAO,IAAI;AACb,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEAzC,QAAQ,CAACe,SAAS,CAACM,KAAK,GAAG,UAAUmB,MAAM,EAAE;EAC3C,IAAI,IAAI,CAAClC,IAAI,EAAE;EACf,IAAI,CAACJ,KAAK,GAAGN,KAAK;EAClB,IAAI,CAACO,OAAO,GAAG,EAAE;EACjB,IAAI,CAACC,UAAU,GAAG,CAAC,CAAC;EACpB,IAAI,CAACC,UAAU,GAAG,CAAC;AACrB,CAAC;;AAED;AACA;AACA;;AAEA,SAASuB,WAAWA,CAACO,MAAM,EAAES,IAAI,EAAE;EACjC,KAAK,IAAIpB,CAAC,GAAG,CAAC,EAAEqB,CAAC,GAAGV,MAAM,CAACf,MAAM,EAAEI,CAAC,GAAGqB,CAAC,EAAE,EAAErB,CAAC,EAAE;IAC7C,IAAIW,MAAM,CAACX,CAAC,CAAC,KAAKoB,IAAI,EAAE,OAAOpB,CAAC;EAClC;EACA,OAAO,CAAC,CAAC;AACX","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}